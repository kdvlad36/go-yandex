# Шаблон для Serverless Containers в Yandex Cloud

Этот шаблон предоставляет универсальный механизм для деплоя контейнеров в Yandex Cloud Serverless Containers.

## Особенности

- Автоматическая проверка наличия сервисных аккаунтов
- Выбор сервисного аккаунта из существующих или создание нового 
- Полностью автоматизированный деплой контейнеров
- Настройка API Gateway для доступа к сервисам

## Требования

- Docker
- Yandex Cloud CLI (yc)
- jq

## Как использовать

### Деплой контейнера hello-world

```bash
make deploy-hello
```

Эта команда выполнит следующие шаги:
1. Проверит наличие сервисных аккаунтов
   - Если сервисные аккаунты отсутствуют, предложит создать новый
   - Если найден один сервисный аккаунт, автоматически выберет его
   - Если найдено несколько аккаунтов, предложит выбрать один из списка
2. Соберет и отправит образ контейнера в Container Registry
3. Создаст или обновит контейнер в Serverless Containers
4. Настроит API Gateway для доступа к контейнеру

### Дополнительные команды

```bash
# Сборка всех контейнеров
make build

# Запуск тестов
make test

# Очистка Docker-образов 
make clean

# Показать справку
make help
```

## Структура проекта

```
.
├── Makefile                                # Основные команды
├── containers/                             # Каталог с контейнерами
│   └── hello-world/                        # Пример контейнера
│       ├── Dockerfile                      # Сборка образа
│       └── deploy/                         # Скрипты деплоя
│           ├── deploy.sh                   # Основной скрипт деплоя
│           └── api-gateway-spec.yaml       # Спецификация API Gateway
└── tools/                                  # Общие инструменты
    └── check-service-account.sh            # Скрипт проверки сервисных аккаунтов
```

## Доступные контейнеры

1. **hello-world** - Простой демонстрационный контейнер "Hello World"
   - GET/POST запросы с параметром `name`
   - Возвращает приветственное сообщение в формате JSON

## Использование

### Подготовка окружения

1. Установите Docker, Yandex Cloud CLI и настройте облако:
   ```bash
   yc init
   ```

2. Установите зависимости Go в корневой директории проекта:
   ```bash
   go mod tidy
   ```

### Деплой контейнера

Для деплоя контейнера выполните скрипт в директории контейнера:

```bash
cd func/<имя_контейнера>/deploy/
./deploy.sh
```

### Создание нового контейнера

1. Скопируйте шаблон hello-world в новую директорию:
   ```bash
   cp -r func/hello-world func/my-new-container
   ```

2. Отредактируйте Dockerfile и код в `main.go` под ваши потребности
3. Обновите спецификацию API в `deploy/api-gateway-spec.yaml`
4. Запустите деплой:
   ```bash
   cd func/my-new-container/deploy/
   ./deploy.sh
   ```

## Требования

- Docker
- Go 1.21 или выше
- Yandex Cloud CLI
- Аккаунт в Yandex Cloud с доступом к Serverless Containers и API Gateway 

## Команды Make

В проекте доступны следующие команды make для автоматизации основных задач:

```bash
make build        # Сборка всех контейнеров
make test         # Запуск тестов
make deploy-hello # Деплой контейнера hello-world
make clean        # Очистка Docker-образов
make help         # Показать список доступных команд
```

## Особенности проекта

- Общий модуль Go (go.mod) для всех контейнеров, обеспечивающий консистентность версий зависимостей
- Автоматическое развертывание контейнеров через Yandex Cloud CLI
- Интеграция с API Gateway
- Шаблоны готовых контейнеров для быстрого старта

**Примечание:** В отличие от Cloud Functions, Serverless Containers предоставляет больше контроля над средой исполнения и позволяет запускать любые приложения, упакованные в контейнеры. 