# Yandex Cloud Functions - Шаблоны и примеры

Этот репозиторий содержит шаблоны и примеры функций для Yandex Cloud Functions с интеграцией API Gateway.

## Структура проекта

```
├── core/                  # Основные библиотеки и скрипты 
│   ├── deploy/            # Скрипты деплоя
│   │   └── deploy-with-api.sh  # Основной скрипт деплоя с API Gateway
│   ├── scripts/           # Инструменты для работы с Yandex Cloud
│   │   ├── list-profiles.sh      # Просмотр доступных профилей и облаков
│   │   ├── set-profile.sh        # Выбор профиля Yandex Cloud
│   │   ├── set-cloud.sh          # Интерактивный выбор облака и каталога
│   │   └── setup-cloud.sh        # Интерактивная настройка Yandex Cloud
│   ├── lib/               # Общие библиотеки 
│   ├── test/              # Тесты
│   └── api-getway/        # Общие настройки API Gateway
│
├── func/                  # Каталог с функциями
│   ├── excel-report/      # Функция для генерации Excel отчетов
│   │   ├── main.go        # Код функции
│   │   ├── deploy.sh      # Скрипт деплоя конкретной функции 
│   │   └── api-gateway-spec.yaml  # Спецификация API Gateway
│   └── hello-world/       # Простая демонстрационная функция
│       ├── main.go        # Код функции
│       ├── deploy.sh      # Скрипт деплоя
│       └── api-gateway-spec.yaml  # Спецификация API Gateway
│
├── go.mod                 # Общий модуль для всех функций
├── go.sum                 # Общий файл зависимостей
└── README.md              # Этот файл
```

## Доступные функции

1. **hello-world** - Простая демонстрационная функция "Hello World"
   - GET/POST запросы с параметром `name`
   - Возвращает приветственное сообщение в формате JSON

2. **excel-report** - Генератор Excel отчетов
   - GET/POST запросы с параметром `projectName`
   - Создает и возвращает Excel файл с отчетом

## Использование

### Подготовка окружения

1. Установите Yandex Cloud CLI и настройте облако с помощью интерактивного скрипта:
   ```bash
   chmod +x core/scripts/setup-cloud.sh
   ./core/scripts/setup-cloud.sh
   ```

2. Установите зависимости Go в корневой директории проекта:
   ```bash
   go mod tidy
   ```

### Деплой функции

Для деплоя функции выполните скрипт в директории функции:

```bash
cd func/<имя_функции>/
./deploy.sh
```

### Создание новой функции

1. Скопируйте шаблон hello-world в новую директорию:
   ```bash
   cp -r func/hello-world func/my-new-function
   ```

2. Отредактируйте файл `deploy.sh` и задайте параметры вашей функции
3. Измените код в `main.go` под ваши потребности
4. Обновите спецификацию API в `api-gateway-spec.yaml`
5. Запустите деплой:
   ```bash
   cd func/my-new-function/
   ./deploy.sh
   ```

## Требования

- Go 1.21 или выше
- Yandex Cloud CLI
- Аккаунт в Yandex Cloud с доступом к Serverless Functions и API Gateway 

## Команды Make

В проекте доступны следующие команды make для автоматизации основных задач:

```bash
make build   # Сборка всех функций
make test    # Запуск тестов
make deploy  # Деплой функции excel-report
make clean   # Очистка бинарных файлов
make help    # Показать список доступных команд
```

## Особенности проекта

- Общий модуль Go (go.mod) для всех функций, обеспечивающий консистентность версий зависимостей
- Инструменты для интерактивной настройки профилей и облаков Yandex Cloud
- Автоматическое развертывание функций через Yandex Cloud CLI
- Интеграция с API Gateway
- Шаблоны готовых функций для быстрого старта

**Примечание:** При миграции с индивидуальных модулей на общий модуль необходимо удалить локальные файлы `go.mod` и `go.sum` из каталогов функций. 